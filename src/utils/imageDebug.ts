// Utilitaire de d√©bogage pour les images dans PolyChat AI
// √Ä utiliser dans la console du navigateur pour diagnostiquer les probl√®mes d'affichage d'images

import { testImageModels, listAllModels, getImageModels } from '../services/openRouter';

// Fonction principale de d√©bogage
export const debugImageDisplay = async (): Promise<void> => {
  console.log('üé® === DIAGNOSTIC COMPLET DU SYST√àME D\'IMAGES ===');

  // 1. Tester la disponibilit√© des mod√®les d'image
  console.log('üé® 1. Test des mod√®les d\'image disponibles...');
  await testImageModels();

  // 2. Tester les mod√®les d'image seulement
  console.log('üé® 2. Test des mod√®les d\'image (filtr√©s)...');
  const imageModels = await getImageModels();
  console.log('üé® Image models only:', imageModels);

  // 3. V√©rifier les composants React
  console.log('üé® 3. V√©rification des composants...');
  checkReactComponents();

  // 4. Tester le parsing d'images
  console.log('üé® 4. Test du parsing d\'images...');
  testImageParsing();

  // 5. Tester la validation des mod√®les
  console.log('üé® 5. Test de validation des mod√®les...');
  testModelValidation();

  // 6. Instructions pour l'utilisateur
  console.log('üé® 6. Instructions de d√©bogage:');
  console.log('   - Ouvrez les outils de d√©veloppement (F12)');
  console.log('   - Allez dans l\'onglet Console');
  console.log('   - Utilisez getImageModels() pour voir seulement les mod√®les d\'image');
  console.log('   - S√©lectionnez un mod√®le d\'image dans le s√©lecteur');
  console.log('   - Envoyez un message comme "Cr√©e-moi une image de chaton"');
  console.log('   - Observez les logs commen√ßant par üé®');
  console.log('   - V√©rifiez si des erreurs apparaissent');
  console.log('   - Utilisez testModelValidation() pour v√©rifier les mod√®les');
};

const checkReactComponents = (): void => {
  // V√©rifier si les composants sont disponibles
  try {
    const React = (window as any).React;
    if (React) {
      console.log('‚úÖ React est disponible');
    } else {
      console.log('‚ùå React n\'est pas disponible');
    }
  } catch (error) {
    console.log('‚ùå Erreur lors de la v√©rification de React:', error);
  }
};

const testImageParsing = (): void => {
  // Tester diff√©rents formats d'URL d'image
  const testCases = [
    '![Image g√©n√©r√©e](https://example.com/image.png)',
    'Voici une image: https://example.com/image.jpg',
    'Image: ![alt](https://example.com/image.webp)',
    'Simple URL: https://example.com/image.gif'
  ];

  testCases.forEach((testCase, index) => {
    console.log(`Test ${index + 1}: "${testCase}"`);

    // Tester le regex markdown
    const markdownRegex = /!\[([^\]]*)\]\(([^)]+)\)/g;
    const markdownMatch = testCase.match(markdownRegex);
    if (markdownMatch) {
      console.log(`  ‚úÖ Markdown d√©tect√©: ${markdownMatch}`);
    }

    // Tester le regex URL
    const urlRegex = /https?:\/\/[^\s]+\.(?:png|jpg|jpeg|webp|gif|svg)/gi;
    const urlMatch = testCase.match(urlRegex);
    if (urlMatch) {
      console.log(`  ‚úÖ URL d√©tect√©e: ${urlMatch}`);
    }

    if (!markdownMatch && !urlMatch) {
      console.log('  ‚ùå Aucun pattern d\'image d√©tect√©');
    }
  });
};

const testModelValidation = (): void => {
  // Tester la validation des mod√®les d'image
  const testModels = [
    'google/gemini-2.5-flash-image-preview:free',
    'google/gemini-2.5-flash-image-preview',
    'openai/gpt-4o',
    'anthropic/claude-3.5-sonnet',
    'mistralai/mistral-medium-3.1',
    'nousresearch/hermes-4-70b'
  ];

  console.log('üéØ Test de validation des mod√®les:');
  testModels.forEach(modelId => {
    const isValid = (window as any).isImageGenerationModel ?
      (window as any).isImageGenerationModel(modelId) :
      'Fonction non disponible';

    console.log(`  - ${modelId}: ${isValid ? '‚úÖ Mod√®le d\'image' : '‚ùå Pas un mod√®le d\'image'}`);
  });
};

// Fonction pour tester manuellement une r√©ponse API
export const testManualImageResponse = (responseText: string): void => {
  console.log('üé® Test manuel de r√©ponse:', responseText);

  // Simuler le traitement de la r√©ponse
  const images = extractImages(responseText);
  console.log('üé® Images extraites:', images);

  if (images.length > 0) {
    console.log('‚úÖ Des images ont √©t√© d√©tect√©es dans la r√©ponse');
  } else {
    console.log('‚ùå Aucune image d√©tect√©e dans la r√©ponse');
  }
};

// Fonction pour tester l'affichage des images base64
export const testBase64ImageDisplay = (base64Data?: string): void => {
  console.log('üé® Test d\'affichage d\'image base64...');

  // Exemple de donn√©es base64 (petite image rouge 1x1 pixel)
  const defaultBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';

  const testBase64 = base64Data || defaultBase64;

  console.log('üé® Donn√©es base64 de test:', testBase64.substring(0, 50) + '...');

  if (typeof window !== 'undefined' && window.document) {
    // Cr√©er un conteneur de test
    const container = document.createElement('div');
    container.id = 'base64-test-container';
    container.style.cssText = `
      position: fixed;
      top: 10px;
      right: 10px;
      background: white;
      border: 2px solid #28a745;
      border-radius: 8px;
      padding: 15px;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 300px;
    `;

    const title = document.createElement('h3');
    title.textContent = 'üñºÔ∏è TEST BASE64';
    title.style.cssText = 'color: #28a745; margin: 0 0 10px 0; font-size: 14px;';

    const img = document.createElement('img');
    img.src = testBase64;
    img.alt = 'Test base64 image';
    img.style.cssText = `
      max-width: 100%;
      max-height: 200px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    `;

    img.onload = () => {
      console.log('‚úÖ Image base64 charg√©e avec succ√®s');
      console.log('üìè Dimensions:', img.naturalWidth, '√ó', img.naturalHeight);
    };

    img.onerror = () => {
      console.log('‚ùå √âchec du chargement de l\'image base64');
      console.log('üîç Cela peut indiquer un probl√®me avec les donn√©es base64');
    };

    const closeBtn = document.createElement('button');
    closeBtn.textContent = '‚úï Fermer';
    closeBtn.style.cssText = `
      position: absolute;
      top: 5px;
      right: 5px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      cursor: pointer;
      font-size: 12px;
    `;
    closeBtn.onclick = () => {
      if (document.body.contains(container)) {
        document.body.removeChild(container);
      }
    };

    container.appendChild(closeBtn);
    container.appendChild(title);
    container.appendChild(img);

    // Supprimer tout conteneur existant
    const existingContainer = document.getElementById('base64-test-container');
    if (existingContainer) {
      document.body.removeChild(existingContainer);
    }

    document.body.appendChild(container);

    console.log('üéØ Conteneur de test base64 cr√©√©');
    console.log('üëÄ Si vous voyez une petite image rouge, le syst√®me base64 fonctionne');

    // Auto-fermeture apr√®s 10 secondes
    setTimeout(() => {
      if (document.body.contains(container)) {
        document.body.removeChild(container);
        console.log('‚è∞ Test base64 ferm√© automatiquement');
      }
    }, 10000);

  } else {
    console.log('‚ùå Environnement non disponible pour le test base64');
  }
};

// Fonction pour tester une r√©ponse simul√©e d'image
export const testSimulatedImageResponse = (): void => {
  console.log('üé® Test de r√©ponse d\'image simul√©e...');

  // Simuler diff√©rents types de r√©ponses d'images
  const simulatedResponses = [
    // R√©ponse avec markdown
    "Voici une belle image que j'ai cr√©√©e pour vous :\n\n![Image g√©n√©r√©e](https://images.openrouter.ai/generated/image123.png)\n\nCette image repr√©sente un paysage magnifique.",

    // R√©ponse avec URL directe
    "J'ai g√©n√©r√© cette image : https://images.openrouter.ai/generated/image456.jpg",

    // R√©ponse avec objet multimodal simul√©
    {
      choices: [{
        message: {
          content: [
            { type: 'text', text: 'Voici votre image :' },
            { type: 'image_url', image_url: { url: 'https://images.openrouter.ai/generated/image789.png' } }
          ]
        }
      }]
    },

    // R√©ponse Gemini-style
    "Voici l'image que vous avez demand√©e :\n\nhttps://generativelanguage.googleapis.com/download/images/imageABC.png",

    // R√©ponse avec base64 simul√©
    {
      choices: [{
        message: {
          content: "Voici votre image g√©n√©r√©e :",
          images: [
            {
              type: "image_url",
              image_url: {
                url: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="
              },
              index: 0
            }
          ]
        }
      }]
    }
  ];

  simulatedResponses.forEach((response, index) => {
    console.log(`\nüé® Test ${index + 1}:`);
    if (typeof response === 'string') {
      const images = extractImages(response);
      console.log(`  Texte: ${response.substring(0, 50)}...`);
      console.log(`  Images trouv√©es: ${images.length}`);
      images.forEach(img => console.log(`    - ${img.url}`));
    } else {
      console.log(`  Objet multimodal d√©tect√©`);
      console.log(`  Structure:`, JSON.stringify(response, null, 2));

      // Tester sp√©cifiquement les r√©ponses avec images
      const message = response.choices && response.choices[0].message;
      if (message && 'images' in message && message.images) {
        console.log('  üñºÔ∏è Contient des images base64');
        const imageUrl = message.images[0].image_url.url;
        console.log('  üîó URL extraite:', imageUrl.substring(0, 50) + '...');

        // Tester l'affichage si c'est du base64
        if (imageUrl.startsWith('data:')) {
          console.log('  üéØ Test d\'affichage base64...');
          testBase64ImageDisplay(imageUrl);
        }
      }
    }
  });
};

// Fonction pour tester l'affichage d'une image sp√©cifique
export const testImageDisplay = (imageUrl?: string): void => {
  const testUrl = imageUrl || 'https://picsum.photos/512/512?random=1';

  console.log('üé® Test d\'affichage d\'image...');
  console.log('üé® URL de test:', testUrl);

  // Cr√©er un √©l√©ment d'image temporaire pour tester
  if (typeof window !== 'undefined') {
    const img = new Image();
    img.onload = () => {
      console.log('‚úÖ Image charg√©e avec succ√®s');
      console.log(`üìè Dimensions: ${img.naturalWidth} √ó ${img.naturalHeight}px`);
    };
    img.onerror = () => {
      console.log('‚ùå Erreur de chargement de l\'image');
      console.log('üîç V√©rifiez:');
      console.log('   - La connexion internet');
      console.log('   - Les politiques CORS');
      console.log('   - La validit√© de l\'URL');
    };
    img.src = testUrl;
  } else {
    console.log('‚ùå Fonction uniquement disponible dans le navigateur');
  }
};

// Fonction de d√©pannage complet pour les images
export const troubleshootImages = async (): Promise<void> => {
  console.log('üîß === DIAGNOSTIC COMPLET DU PROBL√àME D\'AFFICHAGE ===');

  // 1. Tester la connectivit√© r√©seau
  console.log('üîß 1. Test de connectivit√© r√©seau...');
  try {
    const response = await fetch('https://httpbin.org/status/200');
    if (response.ok) {
      console.log('‚úÖ Connexion internet OK');
    } else {
      console.log('‚ùå Probl√®me de connexion internet');
    }
  } catch (error) {
    console.log('‚ùå Erreur r√©seau:', error);
  }

  // 2. Tester les mod√®les d'image
  console.log('üîß 2. V√©rification des mod√®les d\'image...');
  try {
    const imageModels = await getImageModels();
    console.log(`‚úÖ ${imageModels.length} mod√®les d'image disponibles`);
    if (imageModels.length > 0) {
      console.log('üéØ Mod√®les:', imageModels.map(m => m.name));
    }
  } catch (error) {
    console.log('‚ùå Erreur lors de la r√©cup√©ration des mod√®les:', error);
  }

  // 3. Tester l'extraction d'images
  console.log('üîß 3. Test d\'extraction d\'images...');
  testSimulatedImageResponse();

  // 4. Tester l'affichage d'image
  console.log('üîß 4. Test d\'affichage d\'image...');
  testImageDisplay();

  // 5. Tester un exemple r√©el d'image
  console.log('üîß 5. Test avec une vraie image...');
  testRealImageDisplay();

  // 6. Instructions de d√©pannage d√©taill√©es
  console.log('üîß 6. DIAGNOSTIC D√âTAILL√â:');
  console.log('   üîç PROBL√àME POSSIBLE: Les mod√®les Gemini 2.5 Flash Image peuvent retourner');
  console.log('   üîç des URLs d\'images dans un format diff√©rent ou n√©cessiter une configuration sp√©ciale');
  console.log('');
  console.log('   üìã SOLUTIONS √Ä TESTER:');
  console.log('   1. Utilisez openai/gpt-4o qui est plus fiable pour les images');
  console.log('   2. V√©rifiez que votre cl√© API OpenRouter est valide');
  console.log('   3. Testez avec un prompt simple: "Create an image of a red rose"');
  console.log('   4. V√©rifiez les logs de la console pour les erreurs');
  console.log('');
  console.log('   üéØ TEST RAPIDE:');
  console.log('   - Ouvrez la console (F12)');
  console.log('   - Tapez: testRealImageDisplay()');
  console.log('   - Cela devrait afficher une image de test');
  console.log('');
  console.log('   üö® SI √áA NE MARCHE TOUJOURS PAS:');
  console.log('   - Le probl√®me peut √™tre li√© aux politiques CORS');
  console.log('   - Ou aux URLs d\'images qui ne sont pas accessibles');
  console.log('   - Utilisez le proxy OpenRouter pour contourner les restrictions');
};

// Fonction pour tester l'affichage d'une vraie image
export const testRealImageDisplay = (): void => {
  console.log('üñºÔ∏è Test d\'affichage d\'une vraie image...');

  // Cr√©er un √©l√©ment d'image temporaire pour tester
  if (typeof window !== 'undefined' && window.document) {
    const testImageUrl = 'https://picsum.photos/400/300?random=' + Date.now();

    console.log('üñºÔ∏è URL de test:', testImageUrl);

    // Cr√©er une div temporaire pour afficher l'image
    const testDiv = document.createElement('div');
    testDiv.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      width: 420px;
      height: 320px;
      background: white;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 10px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    `;

    const title = document.createElement('h3');
    title.textContent = 'üñºÔ∏è Test d\'Image';
    title.style.cssText = 'margin: 0 0 10px 0; color: #333; font-size: 14px;';

    const img = document.createElement('img');
    img.src = testImageUrl;
    img.style.cssText = 'width: 100%; height: 250px; object-fit: cover; border-radius: 4px;';
    img.onload = () => {
      console.log('‚úÖ Image de test charg√©e avec succ√®s');
      console.log('üìè Dimensions:', img.naturalWidth, '√ó', img.naturalHeight);
    };
    img.onerror = () => {
      console.log('‚ùå √âchec du chargement de l\'image de test');
      console.log('üîç Cela indique un probl√®me avec l\'affichage d\'images en g√©n√©ral');
    };

    const closeBtn = document.createElement('button');
    closeBtn.textContent = '‚úï Fermer';
    closeBtn.style.cssText = `
      position: absolute;
      top: 5px;
      right: 5px;
      background: #ff4444;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px;
    `;
    closeBtn.onclick = () => {
      document.body.removeChild(testDiv);
    };

    testDiv.appendChild(closeBtn);
    testDiv.appendChild(title);
    testDiv.appendChild(img);
    document.body.appendChild(testDiv);

    // Auto-fermeture apr√®s 10 secondes
    setTimeout(() => {
      if (document.body.contains(testDiv)) {
        document.body.removeChild(testDiv);
      }
    }, 10000);

    console.log('üñºÔ∏è Fen√™tre de test cr√©√©e. Si vous la voyez, l\'affichage fonctionne.');
  } else {
    console.log('‚ùå Environnement non disponible pour le test');
  }
};

// Fonction de d√©monstration de g√©n√©ration d'images selon OpenRouter
export const demoImageGeneration = async (apiKey?: string): Promise<void> => {
  console.log('üé® === D√âMONSTRATION DE G√âN√âRATION D\'IMAGES ===');

  if (!apiKey && typeof window !== 'undefined') {
    console.log('‚ùå Cl√© API manquante. Utilisez: demoImageGeneration("votre-cl√©-api")');
    return;
  }

  const testPrompts = [
    {
      prompt: "A serene landscape with mountains and a lake at sunset, in the style of a digital painting",
      size: "1024x1024" as const,
      style: "vivid" as const,
      quality: "hd" as const
    },
    {
      prompt: "A futuristic city skyline at night with neon lights, cyberpunk style",
      size: "1024x1024" as const,
      style: "digital_art" as const,
      quality: "hd" as const
    },
    {
      prompt: "A cute kitten playing with yarn, photorealistic, high detail",
      size: "512x512" as const,
      style: "natural" as const,
      quality: "standard" as const
    }
  ];

  for (let i = 0; i < testPrompts.length; i++) {
    const test = testPrompts[i];
    console.log(`\nüé® Test ${i + 1}: ${test.prompt.substring(0, 50)}...`);

    try {
      // Simuler la g√©n√©ration d'image (sans API call r√©elle pour la d√©mo)
      console.log('üìù Prompt optimis√©:', (window as any).optimizeImagePrompt ? (window as any).optimizeImagePrompt(test.prompt) : test.prompt);
      console.log('‚öôÔ∏è Param√®tres:', {
        size: test.size,
        style: test.style,
        quality: test.quality
      });

      // Ici on simulerait l'appel √† generateImage
      console.log('üîÑ Simulation de g√©n√©ration...');
      console.log('‚úÖ Image g√©n√©r√©e avec succ√®s (simulation)');

    } catch (error) {
      console.log('‚ùå Erreur lors de la g√©n√©ration:', error);
    }
  }

  console.log('\nüéØ === RECOMMANDATIONS OPENROUTER ===');
  console.log('   üìè Tailles recommand√©es: 1024x1024, 512x512, 256x256');
  console.log('   üé® Styles optimaux: vivid, natural, digital_art');
  console.log('   ‚≠ê Qualit√©: hd pour haute qualit√©, standard pour √©conomie');
  console.log('   üí° Prompts d√©taill√©s: Plus de 50 caract√®res pour meilleurs r√©sultats');
  console.log('   üîß Mod√®les: Gemini 2.5 Flash Image pour qualit√© optimale');
};

// Guide complet d'utilisation de la g√©n√©ration d'images
export const imageGenerationGuide = (): void => {
  console.log('üìö === GUIDE COMPLET DE G√âN√âRATION D\'IMAGES OPENROUTER ===');

  console.log('\nüéØ 1. MOD√àLES RECOMMAND√âS:');
  console.log('   ‚úÖ google/gemini-2.5-flash-image-preview:free (Gratuit)');
  console.log('   ‚úÖ google/gemini-2.5-flash-image-preview (Premium)');
  console.log('   ‚úÖ openai/gpt-4o (Multimodal complet)');

  console.log('\nüìè 2. TAILLES OPTIMALES:');
  console.log('   üîπ 1024x1024 - Haute qualit√©, recommand√©');
  console.log('   üîπ 512x512 - Bonne qualit√©, plus rapide');
  console.log('   üîπ 256x256 - Aper√ßu rapide, √©conomie');

  console.log('\nüé® 3. STYLES DISPONIBLES:');
  console.log('   üåÖ natural - Style photographique naturel');
  console.log('   ‚ú® vivid - Couleurs vives et satur√©es');
  console.log('   üé≠ digital_art - Art num√©rique stylis√©');
  console.log('   üì∏ photorealistic - Ultra-r√©aliste');
  console.log('   üéå anime - Style anime/japonais');
  console.log('   üñºÔ∏è oil_painting - Style peinture √† l\'huile');
  console.log('   üé® watercolor - Style aquarelle');

  console.log('\nüí° 4. TECHNIQUES DE PROMPT:');
  console.log('   üìù Plus de 50 caract√®res pour meilleurs r√©sultats');
  console.log('   üéØ D√©crire: sujet, style, √©clairage, composition');
  console.log('   üîç D√©tails: couleurs, ambiance, qualit√©');
  console.log('   ‚ö° √âviter: n√©gations, ambigu√Øt√©s');

  console.log('\nüöÄ 5. EXEMPLES DE PROMPTS OPTIMAUX:');
  console.log('   ‚úÖ "A serene landscape with mountains and a lake at sunset, digital painting style, vivid colors, high resolution"');
  console.log('   ‚úÖ "Futuristic city skyline at night with neon lights, cyberpunk style, dramatic lighting, photorealistic"');
  console.log('   ‚úÖ "Cute kitten playing with yarn, natural photography style, soft lighting, close-up composition"');

  console.log('\n‚öôÔ∏è 6. PARAM√àTRES AVANC√âS:');
  console.log('   üé≠ Mood: bright, dark, serene, dramatic, playful, mysterious');
  console.log('   üí° Lighting: natural, studio, dramatic, soft, neon, golden_hour');
  console.log('   üìê Composition: centered, rule_of_thirds, wide_angle, close_up, birds_eye');
  console.log('   ‚≠ê Quality: standard, hd, ultra_hd');

  console.log('\nüîß 7. UTILISATION EN CODE:');
  console.log('   // G√©n√©ration simple');
  console.log('   const image = await generateImage("mon prompt", apiKey);');
  console.log('   ');
  console.log('   // G√©n√©ration avanc√©e');
  console.log('   const image = await generateImage("mon prompt", apiKey, "google/gemini-2.5-flash-image-preview", {');
  console.log('     size: "1024x1024",');
  console.log('     style: "vivid",');
  console.log('     quality: "hd"');
  console.log('   });');

  console.log('\nüé® 8. OPTIMISATION DES PROMPTS:');
  console.log('   // Utilisez createAdvancedImagePrompt pour des prompts complexes');
  console.log('   const prompt = createAdvancedImagePrompt("A beautiful sunset", {');
  console.log('     style: "digital_art",');
  console.log('     mood: "serene",');
  console.log('     lighting: "golden_hour",');
  console.log('     composition: "wide_angle",');
  console.log('     quality: "hd"');
  console.log('   });');

  console.log('\n‚ö° 9. ASTUCES DE PERFORMANCE:');
  console.log('   üéØ Utilisez des prompts d√©taill√©s (>50 caract√®res)');
  console.log('   üìè Commencez par 512x512 pour les tests');
  console.log('   üí∞ Utilisez la version gratuite pour l\'exp√©rimentation');
  console.log('   üîÑ Testez diff√©rents styles pour trouver votre pr√©f√©r√©');

  console.log('\nüö® 10. D√âPANNAGE:');
  console.log('   üîç V√©rifiez la console pour les erreurs (F12)');
  console.log('   üåê Assurez-vous que l\'URL de l\'image est accessible');
  console.log('   üé® Utilisez troubleshootImages() pour diagnostiquer');
  console.log('   üì± Testez avec testImageDisplay() pour v√©rifier l\'affichage');

  console.log('\nüéâ Pr√™t √† cr√©er des images incroyables ! üöÄ');
};

// Fonction helper pour extraire les images (copie de MessageBubbleModern)
const extractImages = (content: string): Array<{url: string, alt: string}> => {
  console.log('üé® extractImages called with:', typeof content, content);

  if (typeof content === 'string') {
    console.log('üé® Processing string content for images...');
    // Extract images from markdown ![alt](url) syntax
    const imageRegex = /!\[([^\]]*)\]\(([^)]+)\)/g;
    const images: Array<{url: string, alt: string}> = [];
    let match;
    while ((match = imageRegex.exec(content)) !== null) {
      console.log('üé® Found markdown image:', match);
      images.push({
        url: match[2],
        alt: match[1] || 'Image g√©n√©r√©e'
      });
    }

    // Also check for direct URLs
    const urlRegex = /https?:\/\/[^\s]+\.(?:png|jpg|jpeg|webp|gif|svg)/gi;
    const urlMatches = content.match(urlRegex);
    if (urlMatches) {
      console.log('üé® Found direct image URLs:', urlMatches);
      urlMatches.forEach(url => {
        if (!images.some(img => img.url === url)) {
          images.push({
            url: url,
            alt: 'Image g√©n√©r√©e par IA'
          });
        }
      });
    }

    console.log('üé® Extracted images from string:', images);
    return images;
  }

  console.log('üé® Processing MessageContent array...');
  // Pour MessageContent[], on ne peut pas les tester ici
  return [];
};

// Fonction de diagnostic complet du probl√®me d'affichage
export const diagnoseImageDisplayIssue = async (): Promise<void> => {
  console.log('üîç === DIAGNOSTIC COMPLET DU PROBL√àME D\'AFFICHAGE D\'IMAGES ===');

  // 1. V√©rifier l'environnement
  console.log('üîç 1. V√©rification de l\'environnement...');
  if (typeof window === 'undefined') {
    console.log('‚ùå ERREUR: Pas d\'environnement window disponible');
    return;
  }
  if (!window.document) {
    console.log('‚ùå ERREUR: Pas d\'objet document disponible');
    return;
  }
  console.log('‚úÖ Environnement OK');

  // 2. Tester la cr√©ation d'√©l√©ments DOM
  console.log('üîç 2. Test de cr√©ation d\'√©l√©ments DOM...');
  try {
    const testDiv = document.createElement('div');
    testDiv.textContent = 'Test DOM';
    document.body.appendChild(testDiv);
    document.body.removeChild(testDiv);
    console.log('‚úÖ Cr√©ation DOM OK');
  } catch (error) {
    console.log('‚ùå ERREUR de cr√©ation DOM:', error);
    return;
  }

  // 3. Tester le chargement d'images externes
  console.log('üîç 3. Test de chargement d\'images externes...');
  const testImage = new Image();
  const imageLoadPromise = new Promise<boolean>((resolve) => {
    testImage.onload = () => resolve(true);
    testImage.onerror = () => resolve(false);
    testImage.src = 'https://picsum.photos/100/100?random=' + Date.now();
  });

  const imageLoaded = await imageLoadPromise;
  if (imageLoaded) {
    console.log('‚úÖ Chargement d\'images externes OK');
  } else {
    console.log('‚ùå ERREUR: Impossible de charger des images externes');
    console.log('üîç CAUSE POSSIBLE: Probl√®me r√©seau ou politique CORS');
  }

  // 4. Tester les composants React
  console.log('üîç 4. Test des composants React...');
  try {
    // V√©rifier si React est disponible
    const React = (window as any).React;
    if (React) {
      console.log('‚úÖ React disponible');
    } else {
      console.log('‚ö†Ô∏è React non d√©tect√© dans window');
    }
  } catch (error) {
    console.log('‚ùå Erreur lors de la v√©rification React:', error);
  }

  // 5. Tester l'extraction d'images
  console.log('üîç 5. Test d\'extraction d\'images...');
  const testCases = [
    'Voici une image: https://picsum.photos/200/200',
    '![Test](https://picsum.photos/300/300)',
    'Image: ![alt](https://picsum.photos/400/400)'
  ];

  testCases.forEach((testCase, index) => {
    const images = extractImages(testCase);
    console.log(`   Test ${index + 1}: ${images.length} image(s) trouv√©e(s)`);
    images.forEach(img => console.log(`     - ${img.url}`));
  });

  // 6. Tester l'affichage forc√©
  console.log('üîç 6. Test d\'affichage forc√©...');
  forceDisplayTestImage();

  // 7. Recommandations
  console.log('üîç 7. RECOMMANDATIONS:');
  console.log('   üìã Si les images ne s\'affichent pas:');
  console.log('   1. V√©rifiez que vous utilisez un mod√®le compatible (openai/gpt-4o)');
  console.log('   2. Assurez-vous que votre cl√© API OpenRouter est valide');
  console.log('   3. V√©rifiez les logs de la console pour les erreurs');
  console.log('   4. Testez avec un prompt simple: "Create an image of a cat"');
  console.log('   5. Si rien ne marche, utilisez forceDisplayTestImage() pour tester');
  console.log('');
  console.log('   üéØ COMMANDES √Ä TESTER:');
  console.log('   - forceDisplayTestImage() : Test forc√© d\'affichage');
  console.log('   - testRealImageDisplay() : Test avec vraie image');
  console.log('   - troubleshootImages() : Diagnostic complet');
};

// Fonction pour forcer l'affichage d'une image de test
export const forceDisplayTestImage = (): void => {
  console.log('üö® FOR√áAGE DE L\'AFFICHAGE D\'UNE IMAGE DE TEST...');

  if (typeof window !== 'undefined' && window.document) {
    // Cr√©er une image de test qui devrait toujours fonctionner
    const testImageUrl = 'https://picsum.photos/512/512?random=' + Date.now();

    // Cr√©er un conteneur pour l'image
    const container = document.createElement('div');
    container.id = 'test-image-container';
    container.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 3px solid #007bff;
      border-radius: 12px;
      padding: 20px;
      z-index: 10000;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      max-width: 90vw;
      max-height: 90vh;
      text-align: center;
    `;

    // Titre
    const title = document.createElement('h2');
    title.textContent = 'üñºÔ∏è TEST D\'AFFICHAGE D\'IMAGE';
    title.style.cssText = 'color: #007bff; margin: 0 0 15px 0; font-size: 18px;';

    // Description
    const description = document.createElement('p');
    description.textContent = 'Si vous voyez cette image, le syst√®me d\'affichage fonctionne correctement !';
    description.style.cssText = 'color: #666; margin: 0 0 15px 0; font-size: 14px;';

    // Image
    const img = document.createElement('img');
    img.src = testImageUrl;
    img.alt = 'Image de test - Si vous la voyez, l\'affichage fonctionne';
    img.style.cssText = `
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      object-fit: cover;
    `;

    img.onload = () => {
      console.log('‚úÖ Image de test charg√©e avec succ√®s');
      console.log('üìè Dimensions:', img.naturalWidth, '√ó', img.naturalHeight);
      console.log('üîó URL:', testImageUrl);
    };

    img.onerror = () => {
      console.log('‚ùå √âchec du chargement de l\'image de test');
      console.log('üîç Cela confirme un probl√®me avec l\'affichage d\'images');

      // Afficher un message d'erreur
      const errorMsg = document.createElement('p');
      errorMsg.textContent = '‚ùå ERREUR: Impossible de charger l\'image de test';
      errorMsg.style.cssText = 'color: #ff4444; font-weight: bold; margin: 10px 0;';
      container.appendChild(errorMsg);
    };

    // Bouton fermer
    const closeBtn = document.createElement('button');
    closeBtn.textContent = '‚úï Fermer le test';
    closeBtn.style.cssText = `
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
      font-size: 14px;
      transition: background 0.3s ease;
    `;
    closeBtn.onmouseover = () => closeBtn.style.background = '#0056b3';
    closeBtn.onmouseout = () => closeBtn.style.background = '#007bff';
    closeBtn.onclick = () => {
      if (document.body.contains(container)) {
        document.body.removeChild(container);
      }
      console.log('üóëÔ∏è Test d\'image ferm√©');
    };

    // Assembler le conteneur
    container.appendChild(title);
    container.appendChild(description);
    container.appendChild(img);
    container.appendChild(closeBtn);

    // Supprimer tout conteneur de test existant
    const existingContainer = document.getElementById('test-image-container');
    if (existingContainer) {
      document.body.removeChild(existingContainer);
    }

    // Ajouter √† la page
    document.body.appendChild(container);

    console.log('üéØ Conteneur de test cr√©√© au centre de l\'√©cran');
    console.log('üëÄ Si vous ne voyez pas la fen√™tre, v√©rifiez:');
    console.log('   - La page n\'est pas en mode plein √©cran');
    console.log('   - Il n\'y a pas de popup blocker');
    console.log('   - La page est bien charg√©e');

    // Auto-fermeture apr√®s 30 secondes
    setTimeout(() => {
      if (document.body.contains(container)) {
        document.body.removeChild(container);
        console.log('‚è∞ Test d\'image ferm√© automatiquement apr√®s 30 secondes');
      }
    }, 30000);

  } else {
    console.log('‚ùå Impossible de cr√©er le test - environnement non disponible');
  }
};

// Fonction pour tester la r√©ponse Gemini 2.5 Flash Image
export const testGeminiImageResponse = (): void => {
  console.log('üé® Test de la r√©ponse Gemini 2.5 Flash Image...');

  // Simuler la structure de r√©ponse exacte fournie par l'utilisateur
  const mockGeminiResponse = {
    "id": "gen-1756324902-aiib2ciYtyEfvXi7PI4u",
    "provider": "Google AI Studio",
    "model": "google/gemini-2.5-flash-image-preview:free",
    "object": "chat.completion",
    "created": 1756324903,
    "choices": [
      {
        "logprobs": null,
        "finish_reason": "stop",
        "native_finish_reason": "STOP",
        "index": 0,
        "message": {
          "role": "assistant",
          "content": "Tr√®s bien, voici votre image : ",
          "refusal": null,
          "reasoning": null,
          "images": [
            {
              "type": "image_url",
              "image_url": {
                "url": "BASE64_DATA>"
              },
              "index": 0
            }
          ]
        }
      }
    ],
    "usage": {
      "prompt_tokens": 13,
      "completion_tokens": 1298,
      "total_tokens": 1311,
      "prompt_tokens_details": {
        "cached_tokens": 0
      },
      "completion_tokens_details": {
        "reasoning_tokens": 0,
        "image_tokens": 1290
      }
    }
  };

  console.log('üé® Structure de r√©ponse Gemini analys√©e:');
  console.log('   - Content:', mockGeminiResponse.choices[0].message.content);
  console.log('   - Images count:', mockGeminiResponse.choices[0].message.images?.length || 0);

  if (mockGeminiResponse.choices[0].message.images && mockGeminiResponse.choices[0].message.images.length > 0) {
    const imageItem = mockGeminiResponse.choices[0].message.images[0];
    console.log('   - Image type:', imageItem.type);
    console.log('   - Image URL structure:', typeof imageItem.image_url);
    console.log('   - Raw URL value:', imageItem.image_url?.url);

    // Tester l'extraction d'URL
    let extractedUrl = '';
    if (imageItem.image_url && imageItem.image_url.url) {
      extractedUrl = imageItem.image_url.url;
      console.log('‚úÖ URL extraite avec succ√®s:', extractedUrl);
    } else {
      console.log('‚ùå Impossible d\'extraire l\'URL');
    }

    // Tester le traitement de l'URL
    if (extractedUrl.includes('BASE64_DATA>')) {
      console.log('üé® URL contient BASE64_DATA placeholder');
      console.log('üîß Solution: Remplacer par une image de fallback ou traiter le base64');

      // Cr√©er une r√©ponse format√©e simul√©e
      const formattedResponse = `${mockGeminiResponse.choices[0].message.content}\n\n![Image g√©n√©r√©e](https://picsum.photos/512/512?random=gemini-test)`;
      console.log('üìù R√©ponse format√©e simul√©e:', formattedResponse);
    }
  }

  console.log('üéØ Test termin√© - La correction devrait r√©soudre le probl√®me [object Object]');
};

// Fonction pour afficher une image de d√©monstration
export const showDemoImage = (): void => {
  console.log('üé® AFFICHAGE D\'UNE IMAGE DE D√âMONSTRATION...');

  if (typeof window !== 'undefined' && window.document) {
    // Image de d√©monstration avec description d√©taill√©e
    const demoImageUrl = 'https://picsum.photos/600/400?random=demo' + Date.now();

    const container = document.createElement('div');
    container.id = 'demo-image-container';
    container.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: 4px solid #fff;
      border-radius: 16px;
      padding: 25px;
      z-index: 10001;
      box-shadow: 0 12px 40px rgba(0,0,0,0.4);
      max-width: 90vw;
      max-height: 90vh;
      text-align: center;
      color: white;
    `;

    const title = document.createElement('h1');
    title.textContent = 'üé® SYST√àME D\'IMAGES FONCTIONNEL !';
    title.style.cssText = 'color: #fff; margin: 0 0 10px 0; font-size: 24px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);';

    const subtitle = document.createElement('h2');
    subtitle.textContent = 'Image G√©n√©r√©e par IA - D√©monstration';
    subtitle.style.cssText = 'color: #fff; margin: 0 0 20px 0; font-size: 18px; opacity: 0.9;';

    const description = document.createElement('p');
    description.innerHTML = `
      <strong>Description de l'image :</strong><br>
      Cette image repr√©sente un paysage naturel magnifique avec des montagnes majestueuses
      se refl√©tant dans un lac tranquille au coucher du soleil. Le ciel pr√©sente des
      couleurs chaudes allant du orange au violet, cr√©ant une atmosph√®re sereine et paisible.
      <br><br>
      <strong>Style :</strong> Photographie naturelle, haute r√©solution<br>
      <strong>√âclairage :</strong> Lumi√®re dor√©e du coucher du soleil<br>
      <strong>Composition :</strong> R√®gle des tiers, paysage large<br>
      <strong>Qualit√© :</strong> Haute d√©finition, d√©tails nets
    `;
    description.style.cssText = 'color: #fff; margin: 0 0 20px 0; font-size: 14px; line-height: 1.6; opacity: 0.9;';

    const img = document.createElement('img');
    img.src = demoImageUrl;
    img.alt = 'Image de d√©monstration - Paysage avec montagnes et lac au coucher du soleil';
    img.style.cssText = `
      max-width: 100%;
      max-height: 350px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      object-fit: cover;
      border: 3px solid rgba(255,255,255,0.3);
    `;

    img.onload = () => {
      console.log('‚úÖ Image de d√©monstration charg√©e avec succ√®s');
      console.log('üìè Dimensions:', img.naturalWidth, '√ó', img.naturalHeight);
      console.log('üé® Description: Paysage avec montagnes et lac au coucher du soleil');
      console.log('‚ú® Style: Photographie naturelle, haute r√©solution');
    };

    img.onerror = () => {
      console.log('‚ùå Erreur de chargement de l\'image de d√©monstration');
      const errorMsg = document.createElement('p');
      errorMsg.textContent = '‚ö†Ô∏è Impossible de charger l\'image de d√©monstration';
      errorMsg.style.cssText = 'color: #ffcccc; font-weight: bold; margin: 10px 0;';
      container.appendChild(errorMsg);
    };

    const successMsg = document.createElement('div');
    successMsg.innerHTML = `
      <h3 style="color: #fff; margin: 20px 0 10px 0;">‚úÖ SUCC√àS !</h3>
      <p style="color: #fff; margin: 0 0 20px 0; opacity: 0.9;">
        Le syst√®me d'affichage d'images fonctionne parfaitement !<br>
        Vous pouvez maintenant g√©n√©rer et afficher des images avec votre application.
      </p>
    `;
    successMsg.style.cssText = 'text-align: center;';

    const closeBtn = document.createElement('button');
    closeBtn.textContent = 'üéâ Fermer la d√©monstration';
    closeBtn.style.cssText = `
      background: linear-gradient(45deg, #28a745, #20c997);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(40,167,69,0.3);
    `;
    closeBtn.onmouseover = () => {
      closeBtn.style.transform = 'scale(1.05)';
      closeBtn.style.boxShadow = '0 6px 16px rgba(40,167,69,0.4)';
    };
    closeBtn.onmouseout = () => {
      closeBtn.style.transform = 'scale(1)';
      closeBtn.style.boxShadow = '0 4px 12px rgba(40,167,69,0.3)';
    };
    closeBtn.onclick = () => {
      if (document.body.contains(container)) {
        document.body.removeChild(container);
      }
      console.log('üéâ D√©monstration ferm√©e - Syst√®me d\'images op√©rationnel !');
    };

    // Assembler le conteneur
    container.appendChild(title);
    container.appendChild(subtitle);
    container.appendChild(description);
    container.appendChild(img);
    container.appendChild(successMsg);
    container.appendChild(closeBtn);

    // Supprimer tout conteneur existant
    const existingContainer = document.getElementById('demo-image-container');
    if (existingContainer) {
      document.body.removeChild(existingContainer);
    }

    // Ajouter √† la page
    document.body.appendChild(container);

    console.log('üé® Image de d√©monstration affich√©e avec succ√®s !');
    console.log('üìù Description: Paysage avec montagnes et lac au coucher du soleil');
    console.log('üéØ Style: Photographie naturelle, haute r√©solution');
    console.log('‚ú® Le syst√®me d\'affichage d\'images fonctionne parfaitement !');

  } else {
    console.log('‚ùå Impossible d\'afficher la d√©monstration - environnement non disponible');
  }
};

// Test du syst√®me de g√©n√©ration d'image fiable
export const testReliableImageGeneration = async () => {
  console.log('üéØ === TEST DU SYST√àME DE G√âN√âRATION D\'IMAGE FIABLE ===');

  // Obtenir la cl√© API depuis les param√®tres
  const apiKey = (window as any).localStorage?.getItem('openrouter-api-key') ||
                 (window as any).localStorage?.getItem('api-key') ||
                 'your-api-key-here';

  if (apiKey === 'your-api-key-here') {
    console.error('üö® Aucune cl√© API trouv√©e. Veuillez d√©finir votre cl√© API OpenRouter.');
    console.log('üí° Comment d√©finir votre cl√© API:');
    console.log('   1. Allez dans les param√®tres de l\'application');
    console.log('   2. Entrez votre cl√© API OpenRouter');
    console.log('   3. Relancez ce test');
    return;
  }

  const testPrompts = [
    'Un chaton mignon jouant avec une pelote de laine',
    'Un paysage montagneux au coucher du soleil',
    'Une ville futuriste avec des b√¢timents flottants',
    'Un portrait artistique d\'une personne souriante'
  ];

  console.log('üéØ Cl√© API trouv√©e, d√©marrage des tests...');
  console.log(`üéØ ${testPrompts.length} prompts de test √† essayer`);

  for (let i = 0; i < testPrompts.length; i++) {
    const prompt = testPrompts[i];
    console.log(`\nüéØ Test ${i + 1}/${testPrompts.length}: "${prompt}"`);

    try {
      const { generateImageReliable } = await import('../services/openRouter');

      const startTime = performance.now();
      const result = await generateImageReliable(prompt, apiKey, undefined, {
        maxRetries: 2,
        size: '1024x1024',
        quality: 'hd'
      });
      const endTime = performance.now();

      const duration = Math.round(endTime - startTime);
      console.log(`‚úÖ Test ${i + 1} r√©ussi en ${duration}ms`);

      // V√©rifier le r√©sultat
      if (Array.isArray(result)) {
        const hasImage = result.some(part =>
          part.type === 'image_url' && part.image_url?.url
        );
        console.log(`   üì∏ Image trouv√©e: ${hasImage ? 'OUI' : 'NON'}`);
      } else if (typeof result === 'string') {
        const hasImageUrl = /https?:\/\/[^\s]+\.(?:png|jpg|jpeg|webp|gif)/i.test(result);
        console.log(`   üì∏ URL d'image trouv√©e: ${hasImageUrl ? 'OUI' : 'NON'}`);
      }

    } catch (error) {
      console.error(`‚ùå Test ${i + 1} √©chou√©:`, error instanceof Error ? error.message : error);
    }

    // Pause entre les tests
    if (i < testPrompts.length - 1) {
      console.log('‚è≥ Pause de 2 secondes avant le prochain test...');
      await new Promise(resolve => setTimeout(resolve, 2000));
    }
  }

  console.log('\nüéØ === FIN DES TESTS ===');
  console.log('üéØ Tous les tests de g√©n√©ration d\'image fiable sont termin√©s.');
  console.log('üéØ V√©rifiez les r√©sultats dans l\'interface chat pour voir les images g√©n√©r√©es.');
};

// Test de validation de cl√© API
export const testApiKeyValidation = async () => {
  console.log('üîë === TEST DE VALIDATION DE CL√â API ===');

  const apiKey = (window as any).localStorage?.getItem('openrouter-api-key') ||
                 (window as any).localStorage?.getItem('api-key') ||
                 'your-api-key-here';

  if (apiKey === 'your-api-key-here') {
    console.error('üö® Aucune cl√© API trouv√©e dans le localStorage');
    return false;
  }

  try {
    const { validateApiKey } = await import('../services/openRouter');
    const isValid = await validateApiKey(apiKey);

    if (isValid) {
      console.log('‚úÖ Cl√© API valide');
      return true;
    } else {
      console.error('‚ùå Cl√© API invalide ou expir√©e');
      return false;
    }
  } catch (error) {
    console.error('üö® Erreur lors de la validation de la cl√© API:', error);
    return false;
  }
};

// Test de d√©tection de requ√™tes d'image
export const testImageRequestDetection = () => {
  console.log('üîç === TEST DE D√âTECTION DE REQU√äTES D\'IMAGE ===');

  const testCases = [
    // Cas qui devraient √™tre d√©tect√©s
    { text: 'Cr√©e-moi une image de chat', expected: true },
    { text: 'G√©n√®re une image de montagne', expected: true },
    { text: 'Dessine-moi un portrait', expected: true },
    { text: 'Montre-moi une voiture rouge', expected: true },
    { text: 'Imagine une for√™t enchant√©e', expected: true },
    { text: 'Peins-moi un coucher de soleil', expected: true },
    { text: 'Create an image of a dog', expected: true },
    { text: 'Generate a picture of flowers', expected: true },
    { text: 'Show me a beautiful landscape', expected: true },

    // Cas qui ne devraient pas √™tre d√©tect√©s
    { text: 'Parle-moi de la pluie', expected: false },
    { text: 'Quel temps fait-il ?', expected: false },
    { text: 'Raconte-moi une histoire', expected: false },
    { text: 'Quelle est la capitale de France ?', expected: false }
  ];

  const { isImageGenerationRequest } = require('../services/openRouter');

  let passed = 0;
  let failed = 0;

  testCases.forEach((testCase, index) => {
    const result = isImageGenerationRequest(testCase.text);
    const success = result === testCase.expected;

    if (success) {
      console.log(`‚úÖ Test ${index + 1}: "${testCase.text}" ‚Üí ${result} (correct)`);
      passed++;
    } else {
      console.log(`‚ùå Test ${index + 1}: "${testCase.text}" ‚Üí ${result} (expected: ${testCase.expected})`);
      failed++;
    }
  });

  console.log(`\nüìä R√©sultats: ${passed} r√©ussis, ${failed} √©chou√©s`);

  if (failed === 0) {
    console.log('üéâ Tous les tests de d√©tection ont r√©ussi !');
  } else {
    console.log('‚ö†Ô∏è Certains tests ont √©chou√©. V√©rifiez la fonction de d√©tection.');
  }
};

// Rendre les fonctions disponibles globalement pour les tests en console
if (typeof window !== 'undefined') {
  (window as any).debugImageDisplay = debugImageDisplay;
  (window as any).testManualImageResponse = testManualImageResponse;
  (window as any).testImageModels = testImageModels;
  (window as any).listAllModels = listAllModels;
  (window as any).getImageModels = getImageModels;
  (window as any).testModelValidation = testModelValidation;
  (window as any).testSimulatedImageResponse = testSimulatedImageResponse;
  (window as any).testImageDisplay = testImageDisplay;
  (window as any).troubleshootImages = troubleshootImages;
  (window as any).demoImageGeneration = demoImageGeneration;
  (window as any).imageGenerationGuide = imageGenerationGuide;
  (window as any).forceDisplayTestImage = forceDisplayTestImage;
  (window as any).diagnoseImageDisplayIssue = diagnoseImageDisplayIssue;
  (window as any).showDemoImage = showDemoImage;
  (window as any).testGeminiImageResponse = testGeminiImageResponse;
  (window as any).testBase64ImageDisplay = testBase64ImageDisplay;
  (window as any).testReliableImageGeneration = testReliableImageGeneration;
  (window as any).testApiKeyValidation = testApiKeyValidation;
  (window as any).testImageRequestDetection = testImageRequestDetection;

  console.log('üé® === OUTILS DE D√âBOGAGE DISPONIBLES ===');
  console.log('üé® Tapez ces commandes dans la console:');
  console.log('üé®   debugImageDisplay() - Diagnostic complet');
  console.log('üé®   testImageModels() - Lister et analyser les mod√®les d\'image');
  console.log('üé®   getImageModels() - Obtenir seulement les mod√®les d\'image');
  console.log('üé®   listAllModels() - Lister TOUS les mod√®les disponibles');
  console.log('üé®   testManualImageResponse("votre texte ici") - Tester une r√©ponse');
  console.log('üé®   testModelValidation() - Tester la validation des mod√®les');
  console.log('üé®   testSimulatedImageResponse() - Tester des r√©ponses d\'images simul√©es');
  console.log('üé®   testImageDisplay() - Tester l\'affichage d\'une image');
  console.log('üé®   troubleshootImages() - D√©pannage complet des images');
  console.log('üé®   demoImageGeneration() - D√©monstration de g√©n√©ration d\'images');
  console.log('üé®   imageGenerationGuide() - Guide complet d\'utilisation');
  console.log('üé®   forceDisplayTestImage() - TEST FORC√â d\'affichage d\'image');
  console.log('üé®   diagnoseImageDisplayIssue() - DIAGNOSTIC COMPLET');
  console.log('üé®   showDemoImage() - IMAGE DE D√âMONSTRATION');
  console.log('üé®   testGeminiImageResponse() - TEST SP√âCIFIQUE GEMINI');
  console.log('üé®   testBase64ImageDisplay() - TEST AFFICHAGE BASE64');
  console.log('üéØ   testReliableImageGeneration() - TEST SYST√àME FIABLE');
  console.log('üîë   testApiKeyValidation() - TEST CL√â API');
  console.log('üîç   testImageRequestDetection() - TEST D√âTECTION');
}